---
# v2.0.8: SELinux policy v1.1 + capability helper for CAP_NET_ADMIN
repo: GetPageSpeed/ngx_ipset_access_module
summary: Zero-latency IP blocking using Linux kernel ipsets (v2)
description: |
  High-performance NGINX module for IP-based access control using Linux kernel ipsets.
  
  Key Features:
  
  - Blacklist/Whitelist modes: Block or allow IPs based on ipset membership
  - Honeypot auto-add: Automatically add malicious IPs to ipsets with configurable timeouts and custom HTTP status codes
  - Built-in rate limiting: Per-IP rate limiting with auto-ban to ipsets
  - JavaScript challenges: Proof-of-work challenges to filter bots
  - Dual-stack support: Works with both IPv4 and IPv6 ipsets
  - FirewallD compatible: Integrates with firewall-cmd managed ipsets
  - Whitelist bypass: Whitelisted IPs skip rate limiting and challenges
  - Dry-run mode: Test rules in production without blocking
  - Prometheus metrics: Native /metrics endpoint for monitoring
  - LRU cache: Shared memory cache for high-performance lookups
  
  Uses libipset directly (no CLI fallback) for kernel-level performance.
  Compatible with realip module for proper client IP detection behind proxies.
  
  Note: This module requires CAP_NET_ADMIN capability. The selinux subpackage
  includes a systemd override and helper library to enable this automatically.
plan: enterprise
soname:
  - ngx_http_ipset_access
# Use special template for ipset-access (includes capability helper, systemd override)
spec_template: spec-ipset.j2
# SELinux policy (local path in source tarball)
selinux_package: selinux/nginx_module_ipset_access.te
build_requires:
  - ipset-devel
  - libcap-devel
build_requires_deb:
  - libipset-dev
  - libcap-dev
build_pre: |
  %if 0%{?suse_version}
  ## On SLES, ipset headers are in /usr/include/ipset/libipset instead of /usr/include/libipset
  ln -sf /usr/include/ipset/libipset /usr/include/libipset
  %endif
